<%- include("header", { title : "게시글 보기" }) %>
<link rel="stylesheet" href="/stylesheets/detail.css">
<main class="detail-container">
    <div class="title-block">[제목] <%= post.title %></div>

    <div class="meta-info">
        <div>작성자: <%= post.author %></div>
        <div>작성일: <%= post.created_at %></div>
        <% if (post.updated_at) { %>
            <div>수정일: <%= post.updated_at %></div>
        <% } %>
    </div>

    <div class="content-body">
        <p><%= post.content %></p>
    </div>

    <% if (files && files.length > 0) { %>
        <div class="reply-list">
            <h4>첨부파일</h4>
            <% files.forEach(file => { %>
                <div class="reply-item">
                    <a href="/uploads/<%= file.filename %>" download><%= file.filename %></a>
                </div>
            <% }) %>
        </div>
    <% } %>

    <%
    const isAuthor = user && user.username === post.author;
    const isAdmin = user && user.username === 'admin';
    const isAnon = post.author === '익명';
    %>
    <!-- 답글 섹션 -->
    <% if (replies && replies.length > 0) { %>
        <section class="replies-section">
            <h4>💬 답글 <span>(<%= replies.length %>)</span></h4>
            <% replies.forEach(reply => { %>
                <div class="reply-card">
                    <div class="reply-meta">
                        <span class="reply-author"><%= reply.author %></span>
                        <span class="reply-date"><%= reply.created_at %></span>
                    </div>
                    <div class="reply-content"><%= reply.content %></div>
                </div>
            <% }) %>
        </section>
    <% } %>
    <div class="actions">
        <a href="/board/reply/<%= post.id %>">[답글]</a>
        <% if (isAuthor) { %>
            <a href="/board/edit/<%= post.id %>">[수정]</a>
        <% } else { %>
            <span class="disabled">[수정]</span>
        <% } %>
        <% if (isAuthor || (isAnon && isAdmin)) { %>
            <a href="/board/delete/<%= post.id %>" onclick="return confirm('정말 삭제하시겠습니까?')">[삭제]</a>
        <% } else { %>
            <span class="disabled">[삭제]</span>
        <% } %>
        <a href="/board">[목록]</a>
    </div>
</main>
<%- include("footer") %>

